/* ========================================================================== */
/* Variables                                                                  */
/* ========================================================================== */
:root{
  --panel-bg: #ffffffcc;
  --panel-border: #e1e8f0;
  --panel-br: 14px;
  --ink: #101828;
  --ink-2:#344054;
}

/* ========================================================================== */
/* Base layout                                                                */
/* ========================================================================== */
html, body { height: 100%; margin: 0; }
#map { position: absolute; inset: 0; }
.leaflet-container { touch-action: pan-x pan-y; }
body.panel-open { overflow: hidden; touch-action: none; }

/* ========================================================================== */
/* Floating toggle                                                            */
/* ========================================================================== */
.control-toggle{
  position: absolute; left: 10px; top: 10px; z-index: 1400;
  padding: 8px 12px; border-radius: 999px; cursor: pointer;
  background: #fff; color: var(--ink);
  border: 1px solid var(--panel-border);
  box-shadow: 0 4px 16px rgba(0,0,0,0.08);
  transition: background .15s ease;
}
.control-toggle:hover { background:#f6f8fb; }

/* ========================================================================== */
/* Control panel                                                              */
/* ========================================================================== */
.control-panel{
  position: absolute; z-index: 1200; left: 10px; top: 54px;
  width: 340px; max-width: 92vw;
  max-height: calc(100% - 64px);
  overflow-y: auto; overflow-x: hidden; box-sizing: border-box;

  /* visual */
  background: linear-gradient(180deg, rgba(255,255,255,0.88), rgba(255,255,255,0.84));
  backdrop-filter: blur(8px);
  border: 1px solid rgba(20,114,255,0.12);
  border-radius: 16px;
  color: var(--ink);
  font: 14px system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  box-shadow:
    0 10px 30px rgba(16,24,40,0.12),
    inset 0 1px 0 rgba(255,255,255,0.6);

  /* slide-in */
  transform: translateX(-110%);
  transition: transform 220ms ease;
}
.control-panel.open { transform: translateX(0); }

/* Panel header */
.panel-header{
  display:flex; align-items:center; justify-content:space-between;
  padding: 12px 14px;
  background: linear-gradient(180deg, rgba(246,248,251,0.9), rgba(246,248,251,0.6));
  border-bottom: 1px solid #e8edf3;
}
.panel-header h2{ margin:0; font-size:15px; letter-spacing:.2px; color:#0f172a; }
.icon-btn{
  border: 1px solid var(--panel-border); background:#fff; border-radius:10px;
  padding:4px 8px; cursor:pointer; transition: transform .08s ease, background .15s ease;
}
.icon-btn:hover { background:#eef4ff; }
.icon-btn:active{ transform: scale(.98); }

/* Sections */
.panel-section{ padding:10px 12px; border-bottom:1px dashed #e8edf3; }
.panel-section:last-child{ border-bottom:none; }
.panel-section h3{ margin:0 0 8px; font-size:14px; color:#0f172a; font-weight:700; letter-spacing:.2px; }

/* Filters */
.filters{ display:grid; gap:6px; max-height:200px; overflow:auto; }
.filters label{ display:flex; gap:8px; align-items:center; }
#filters label{ font-size:15px; line-height:1.4; margin-bottom:2px; gap:6px; }
#filters input[type="checkbox"]{ width:18px; height:18px; accent-color:#1472ff; cursor:pointer; }

/* Rows & controls */
.row{ display:flex; gap:8px; flex-wrap:wrap; margin-top:6px; }
.row input[type="text"], .row select{
  flex:1 1 120px; padding:6px 8px; border:1px solid #dbe2ec; border-radius:10px;
  background:#fff; transition: box-shadow .2s ease, border-color .2s ease;
}
.row input[type="text"]:focus, .row select:focus{
  outline:none; border-color:#bcd3ff; box-shadow:0 0 0 4px rgba(20,114,255,0.15);
}
.btn{
  border:1px solid #e5eaf2; background:linear-gradient(180deg,#fff,#f9fbff);
  color:var(--ink); border-radius:12px; padding:8px 12px; cursor:pointer;
  box-shadow:0 4px 16px rgba(0,0,0,0.06);
  transition: background .2s ease, box-shadow .2s ease, transform .08s ease;
  user-select:none;
}
.btn:hover{ background:#eff5ff; box-shadow:0 3px 14px rgba(20,114,255,0.12); }
.btn:active{ transform: translateY(1px); }
.btn[disabled]{ opacity:.5; cursor:not-allowed; }
.muted{ align-self:center; opacity:.8; }

/* Range slider */
input[type="range"]{
  -webkit-appearance:none; height:4px; border-radius:999px;
  background: linear-gradient(90deg, #1472ff 0%, #9cc6ff 100%);
}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none; width:16px; height:16px; border-radius:50%;
  background:#fff; border:2px solid #1472ff; box-shadow:0 2px 8px rgba(20,114,255,.35);
}
input[type="range"]::-moz-range-thumb{
  width:16px; height:16px; border-radius:50%;
  background:#fff; border:2px solid #1472ff; box-shadow:0 2px 8px rgba(20,114,255,.35);
}

/* ========================================================================== */
/* Tabs                                                                       */
/* ========================================================================== */
.tabs{
  position: sticky; top: 0; z-index: 1;
  display: grid; grid-auto-flow: column; grid-auto-columns: 1fr;
  gap:6px; padding:8px 10px 0;
  background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,0));
  backdrop-filter: blur(4px);
  border-bottom:1px solid #eef2f7;
}
.tab-btn{
  position:relative; display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:8px 12px 9px; border-radius:12px; cursor:pointer; font-weight:600; letter-spacing:.2px;
  background:#fff; color:#334155; border:1px solid #e5eaf2;
  transition: color .15s ease, box-shadow .15s ease, background .15s ease, transform .08s ease;
}
.tab-btn:hover{ background:#f6f8fb; box-shadow:0 2px 8px rgba(0,0,0,.06); }
.tab-btn:active{ transform: translateY(1px); }
.tab-btn.active{ background:#eef4ff; color:#0b63ff; border-color:#cfe0ff; }
.tab-btn .ico{ width:16px; height:16px; display:inline-block; opacity:.85; }
.tab-panel{ display:none; padding-top:6px; }
.tab-panel.active{ display:block; }

/* ========================================================================== */
/* Search inside panel                                                        */
/* ========================================================================== */
.search-row{ display:flex; gap:8px; align-items:center; }
#searchInput{
  flex:1 1 auto; padding:8px 10px; border:1px solid #dbe2ec; border-radius:10px;
  background:#fff; transition: box-shadow .2s ease, border-color .2s ease;
}
#searchInput:focus{ outline:none; border-color:#bcd3ff; box-shadow:0 0 0 4px rgba(20,114,255,0.15); }
.search-results{
  margin-top:8px; border:1px solid #e5eaf2; border-radius:12px; overflow:hidden; background:#fff;
  max-height: clamp(240px, 60vh, calc(100dvh - 240px));
  overflow: auto; -webkit-overflow-scrolling: touch;
}
.search-results .item{
  padding:10px 12px; border-bottom:1px solid #f1f4f8; cursor:pointer;
  transition: background .15s ease;
}
.search-results .item:hover{ background:#f6faff; }
.search-results .empty{ padding:10px 12px; color:#667085; font-style:italic; }

/* ========================================================================== */
/* Map adornments & popups                                                    */
/* ========================================================================== */
/* Crosshair at map center */
#crosshair{
  position:absolute; top:50%; left:50%; width:0; height:0; z-index:500;
  transform: translate(-50%, -50%); pointer-events:none;
}
#crosshair::before, #crosshair::after{
  content:""; position:absolute; background:#0adede; opacity:.9; border-radius:1px;
}
#crosshair::before{ width:24px; height:2px; left:-12px; top:-1px; }
#crosshair::after { width:2px; height:24px; left:-1px;  top:-12px; }

/* Access popup */
.popup.access-popup{
  font-family: system-ui, sans-serif; font-size:14px; line-height:1.4;
  width:320px; max-width:320px;
}
.popup.access-popup h4{ margin:0 0 .4rem 0; font-size:15px; color:#003366; }
.popup.access-popup strong{ color:#333; }
.popup.access-popup details summary{ cursor:pointer; color:#1472ff; margin-top:.4rem; }
.popup.access-popup .kv{ border-collapse:collapse; width:100%; font-size:12.5px; margin-top:.3rem; }
.popup.access-popup .kv th{ text-align:left; color:#666; padding-right:.4rem; white-space:nowrap; }
.popup.access-popup .kv td, .popup.access-popup .kv th{ padding:2px 0; border:none; }

/* Contour midpoint labels */
.contour-label{
  background: rgba(255,255,255,0.9);
  border: 1px solid #cfcfcf; border-radius:4px; padding:1px 3px;
  font: 10px/1.1 system-ui, -apple-system, Segoe UI, Roboto, Arial;
  color:#333; box-shadow:0 1px 3px rgba(0,0,0,0.08);
  white-space:nowrap; transform: translate(-50%, -50%);
}

/* Legend */
.legend-items{ font-size:12px; margin-bottom:8px; }
.legend-line{ display:inline-block; width:16px; height:3px; vertical-align:middle; margin-right:6px; background:#000; }
.legend-trail{ background:#1472ff; }
.legend-base{ background:#000; opacity:.6; }
.legend-dot{ display:inline-block; width:10px; height:10px; background:#ff00a8; border-radius:50%; vertical-align:middle; margin-right:6px; }

/* Contour legend block */
.contour-legend{
  margin-top:8px; background:rgba(255,255,255,0.95);
  border:1px solid #e5e7eb; border-radius:12px; padding:10px 12px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.7), 0 2px 10px rgba(0,0,0,0.05);
  font-size:12px;
}
.contour-legend-title{ font-weight:600; color:#0f172a; margin-bottom:6px; }
.contour-ramp{
  height:12px; border-radius:999px; margin:6px 0; border:1px solid #ccc;
  background: linear-gradient(to right,
    #2c7fb8 0%,
    #41b6c4 20%,
    #7fcdbb 40%,
    #a1d99b 50%,
    #fdae61 70%,
    #d95f0e 85%,
    #8c510a 100%);
}
.contour-ticks{
  display:flex; justify-content:space-between; color:#555; font-size:11px; margin-top:2px;
}
.contour-note{
  margin-top:6px; color:#666; background:#f2f7ff; border:1px solid #d7e6ff;
  padding:2px 6px; border-radius:10px;
}

/* CLUPA labels & pane mixing */
.leaflet-pane.clupaPane{ mix-blend-mode:multiply; }
.clupa-label{
  font:12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  color:#1b1f23; pointer-events:none;
  text-shadow: 0 0 3px #fff, 0 0 3px #fff, 0 0 6px #fff;
}

/* ========================================================================== */
/* Leaflet control sizing                                                     */
/* ========================================================================== */
.leaflet-control-container .leaflet-control{ font-size:16px; }
.leaflet-control-zoom a{
  width:38px; height:38px; line-height:38px; font-size:16px;
}
.leaflet-top.leaflet-right{ top:max(10px, env(safe-area-inset-top)); right:10px; }

/* ========================================================================== */
/* Responsive                                                                 */
/* ========================================================================== */
@media (max-width: 768px){
  /* Toggle becomes fixed FAB */
  .control-toggle{
    position: fixed;
    left: 12px;
    top: max(12px, env(safe-area-inset-top));
    padding: 10px 12px; font-size:16px; border-radius:12px;
  }

  /* Panel becomes bottom drawer */
  .control-panel{
    position: fixed;
    left: 12px; right: 12px;
    bottom: max(12px, env(safe-area-inset-bottom));
    top: auto;
    width: auto;
    max-height: 70dvh;
    overflow: auto;
    border-radius: 14px;
    backdrop-filter: blur(6px);
  }

  /* Larger tappable controls and headings */
  .control-panel input,
  .control-panel select,
  .control-panel button,
  .control-panel label{ font-size:16px; line-height:1.25; }
  .control-panel h3{ font-size:17px; margin:10px 0 6px; }

  /* Keep Leaflet controls clear of notches */
  .leaflet-top.leaflet-right{ top: calc(env(safe-area-inset-top) + 10px); right: 10px; }
  .leaflet-top.leaflet-left { top: calc(env(safe-area-inset-top) + 60px); left: 10px; }
}

.custom-pin-icon .pin-emoji {
  font-size: 22px;
  line-height: 24px;
  text-align: center;
  filter: drop-shadow(0 0 2px #0003);
}

.custom-pin-icon {
  transform: translateY(-4px);
}

/* Remove Leaflet's default white background/border from emoji pins */
.leaflet-div-icon.custom-pin-icon {
  background: none !important;
  border: none !important;
  box-shadow: none !important;
}


.pin-list .pin-emoji { display:inline-flex; align-items:center; justify-content:center; width:1.4rem; }
